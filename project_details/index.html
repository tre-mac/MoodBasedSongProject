<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mood-Based Song Recommender</title>
  <style>
    :root{
      --bg:#0f1220;--card:#171a2b;--muted:#8288a1;--text:#e8ebff;--accent:#7c8cff;--accent-2:#9bf0ff;--chip:#232741;--shadow:rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 10% -10%, #232741 0%, transparent 55%),
                  radial-gradient(1000px 400px at 120% 10%, #1b2041 0%, transparent 50%),
                  var(--bg);
      color:var(--text);
    }
    .container{max-width:1100px;margin:48px auto;padding:0 20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    h1{font-size:clamp(1.4rem,2.5vw,2rem);margin:0}
    .sub{color:var(--muted);font-size:.95rem}

    .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,0));
      border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:0 10px 30px var(--shadow);
      padding:18px}

    .controls{display:grid;grid-template-columns:1fr;gap:14px;margin-top:14px}
    @media(min-width:720px){.controls{grid-template-columns:1.2fr .8fr auto auto}}

    .dropdown{position:relative}
    .dropdown button{width:100%;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .btn{
      background:linear-gradient(180deg, #293056, #1a1f3a);
      border:1px solid rgba(255,255,255,.1); color:var(--text);
      padding:12px 14px; border-radius:12px; cursor:pointer; font-weight:600;
      box-shadow:0 6px 18px var(--shadow); transition:transform .05s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:transparent;border:1px dashed rgba(255,255,255,.2)}

    .dropdown-menu{position:absolute;inset:unset;left:0;right:0;top:calc(100% + 8px);
      background:var(--card); border:1px solid rgba(255,255,255,.12); border-radius:14px;
      box-shadow:0 14px 30px var(--shadow); padding:10px; max-height:310px; overflow:auto; display:none; z-index:10}
    .dropdown.open .dropdown-menu{display:block}

    .search{display:flex;gap:10px}
    .search input{flex:1; background:#0e1227; border:1px solid rgba(255,255,255,.12); color:var(--text);
      padding:10px 12px; border-radius:10px}

    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{background:var(--chip);color:var(--accent-2);padding:6px 10px;border-radius:999px;font-size:.85rem;border:1px solid rgba(255,255,255,.12)}

    .results{margin-top:22px;display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:740px){.results{grid-template-columns:1fr 1fr}}

    .song{background:var(--card); border:1px solid rgba(255,255,255,.08); padding:14px; border-radius:14px;
      display:flex; gap:12px; align-items:flex-start}
    .song .score{min-width:42px;height:42px;display:grid;place-items:center;font-weight:800;border-radius:12px;background:#0e1227;border:1px solid rgba(255,255,255,.12)}
    .song h3{margin:.1rem 0 .2rem;font-size:1rem}
    .song .artist{color:var(--muted);font-size:.9rem}

    .meta{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .badge{font-size:.75rem;padding:4px 8px;border-radius:999px;background:#10143a;border:1px solid rgba(255,255,255,.12);color:#b6c3ff}
    .link{margin-left:auto}
    .link a{color:var(--accent);text-decoration:none;font-weight:700}

    footer{margin:30px 0;color:var(--muted);font-size:.9rem}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>ðŸŽ§ Mood-Based Song Recommender</h1>
        <div class="sub">Select all moods that applyâ€”then get curated tracks that fit the vibe.</div>
      </div>
    </header>

    <section class="card">
      <div class="controls">
        <div class="dropdown" id="moodDropdown">
          <button class="btn" id="dropdownToggle" type="button" aria-haspopup="true" aria-expanded="false">
            <span id="dropdownLabel">Select moods (all that apply)</span>
            <span>â–¾</span>
          </button>
          <div class="dropdown-menu" role="menu" aria-label="Mood selector">
            <div class="search">
              <input type="text" id="moodFilter" placeholder="Filter moods..." aria-label="Filter moods" />
              <button class="btn btn-ghost" id="selectAll">Select all</button>
            </div>
            <div id="moodOptions" style="margin-top:8px;display:grid;grid-template-columns:1fr 1fr;gap:6px"></div>
          </div>
          <div class="chips" id="selectedChips" aria-live="polite"></div>
        </div>

        <button class="btn" id="recommendBtn" type="button">ðŸŽµ Get recommendations</button>
        <button class="btn btn-ghost" id="clearBtn" type="button">Clear</button>
        <button class="btn btn-ghost" id="shuffleBtn" type="button">Shuffle list</button>
      </div>

      <div class="results" id="results"></div>
    </section>

    <footer>
      Tip: Results are ranked by how many of your moods each track matches. Click a title to open a YouTube search for quick listening.
    </footer>
  </div>

  <script>
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];

    const dropdown = $('#moodDropdown');
    const toggle = $('#dropdownToggle');
    const optionsWrap = $('#moodOptions');
    const filterInput = $('#moodFilter');
    const selectAllBtn = $('#selectAll');
    const chips = $('#selectedChips');

    const results = $('#results');
    const btnRecommend = $('#recommendBtn');
    const btnClear = $('#clearBtn');
    const btnShuffle = $('#shuffleBtn');

    const MOODS = [
      "Happy","Chill","Energetic","Sad","Romantic","Focus",
      "Confident","Melancholic","Uplifting","Party","Aggressive",
      "Relaxed","Nostalgic","Motivational","Dark"
    ];

    const buildOptions = () => {
      optionsWrap.innerHTML = '';
      MOODS.forEach(m => {
        const id = 'mood_' + m.replace(/\s+/g, '').toLowerCase();
        const row = document.createElement('label');
        row.style.display = 'flex'; row.style.alignItems = 'center'; row.style.gap = '8px';
        row.innerHTML = `<input type="checkbox" value="${m}" id="${id}"> <span>${m}</span>`;
        optionsWrap.appendChild(row);
      });
    };

    const getSelectedMoods = () => $$('#moodOptions input:checked').map(i => i.value);

    const setSelectedChips = () => {
      chips.innerHTML = '';
      const selected = getSelectedMoods();
      $('#dropdownLabel').textContent = selected.length ? `${selected.length} mood${selected.length>1?'s':''} selected` : 'Select moods (all that apply)';
      selected.forEach(m => {
        const c = document.createElement('span');
        c.className = 'chip'; c.textContent = m; chips.appendChild(c);
      });
    };

    toggle.addEventListener('click', () => {
      dropdown.classList.toggle('open'));
      toggle.setAttribute('aria-expanded', dropdown.classList.contains('open'));
      if (dropdown.classList.contains('open')) filterInput.focus();
    });
    document.addEventListener('click', (e) => {
      if (!dropdown.contains(e.target)) dropdown.classList.remove('open');
    });

    filterInput.addEventListener('input', () => {
      const q = filterInput.value.toLowerCase();
      $$('#moodOptions label').forEach(lbl => {
        const txt = lbl.textContent.toLowerCase();
        lbl.style.display = txt.includes(q) ? 'flex' : 'none';
      });
    });

    selectAllBtn.addEventListener('click', () => {
      const visible = $$('#moodOptions label').filter(lbl => lbl.style.display !== 'none');
      const inputs = visible.map(v => v.querySelector('input'));
      const allChecked = inputs.every(i => i.checked);
      inputs.forEach(i => i.checked = !allChecked);
      setSelectedChips();
    });

    optionsWrap.addEventListener('change', setSelectedChips);

    const toYT = (title, artist) =>
      `https://www.youtube.com/results?search_query=${encodeURIComponent(`${title} ${artist}`)}`;

    const render = (items) => {
      results.innerHTML = '';
      if (!items || !items.length){
        results.innerHTML = '<div class="sub">No recommendations found. Try broadening your mood selection.</div>';
        return;
      }
      items.forEach(song => {
        const el = document.createElement('article');
        el.className = 'song';
        el.innerHTML = `
          <div class="score" title="Matched moods">âœ”</div>
          <div style="flex:1">
            <h3><a href="${toYT(song.title, song.artist)}" target="_blank" rel="noopener">${song.title}</a></h3>
            <div class="artist">${song.artist} â€¢ ${song.year || ''}</div>
            <div class="meta">
              ${(song.moods || []).map(mm => `<span class="badge">${mm}</span>`).join('')}
            </div>
          </div>
        `;
        results.appendChild(el);
      });
    };

    const fetchRecommendations = async () => {
      const selected = getSelectedMoods();
      if (!selected.length){
        results.innerHTML = '<div class="sub">Choose at least one mood to see recommendations.</div>';
        return;
      }

      try {
        const response = await fetch('https://mbfunction.azurewebsites.net/api/GetRecommendations', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ moods: selected })
        });
        const data = await response.json();
        render(data.recommendations);
      } catch (err) {
        console.error('Error fetching recommendations:', err);
        results.innerHTML = '<div class="sub">Failed to fetch recommendations. Try again later.</div>';
      }
    };

    btnRecommend.addEventListener('click', fetchRecommendations);
    btnShuffle.addEventListener('click', fetchRecommendations);
    btnClear.addEventListener('click', () => {
      $$('#moodOptions input:checked').forEach(i => i.checked = false);
      setSelectedChips();
      results.innerHTML = '';
    });

    buildOptions();
    setSelectedChips();
  </script>
</body>
</html>

